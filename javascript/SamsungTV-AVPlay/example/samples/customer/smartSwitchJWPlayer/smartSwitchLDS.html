<!DOCTYPE html>
<html>
	<head>
		<title>SmartSwitch - LDS Scenario</title>
		<script type="text/javascript" src="http://pre.smartplugin.youbora.com/src/v1/1.3/js/libs/youbora-data.js"></script>
		<script type="text/javascript" src="http://pre.smartplugin.youbora.com/src/v1/1.3/js/libs/youbora-api.js"></script>
		<script type="text/javascript" src="http://pre.smartplugin.youbora.com/src/v1/1.3/sp/spyoubora.js"></script>
		<script type="text/javascript" src="jwplayer/jwplayer.js"></script>
		<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	</head>

	<body>

		<div style="padding:20px;" >

			<h1>SmartSwitch - LDS Scenario</h1>

			<div style="height: 300px;" >

				<div id="video_player"></div>

			</div>

			<div style="margin-top: 20px; padding: 5px; border: 1px solid #000; width: 80%; font-family: Consolas, monaco, monospace; color: #FFF; background-color: #666" >SmartSwitch Request</div>
			<div id="requestOut" style="padding: 5px; border: 1px solid #000; width: 80%; font-family: Consolas, monaco, monospace; color: #666;" >

				SmartSwitch Request

			</div>

			<div style="margin-top: 20px; padding: 5px; border: 1px solid #000; width: 80%; font-family: Consolas, monaco, monospace; color: #FFF; background-color: #666" >SmartSwitch Response</div>
			<div id="consoleOut" style="padding: 5px; border: 1px solid #000; width: 80%; font-family: Consolas, monaco, monospace; color: #666;" >

				Result SmartSwitch Request...

			</div>

			<div style="margin-top: 20px; padding: 5px; border: 1px solid #000; width: 80%; font-family: Consolas, monaco, monospace; color: #FFF; background-color: #666" >Ordered Resources</div>
			<div id="resourcesOut" style="padding: 5px; border: 1px solid #000; width: 80%; font-family: Consolas, monaco, monospace; color: #666;" >

				Result SmartSwitch Request...

			</div>

		</div>

		<script type="text/javascript">

			var system 		= "nicetv";
			var zoneCode 	= "default";
			var niceNVA 	= "3600";
			var niceNVB 	= "0";


			var originalResource	= "http://mirrorblender.top-ix.org/movies/sintel-2048-surround.mp4";
			var urlSmartSwitch		= "http://smartswitch.youbora.com/?type=balance&systemcode=" + system + "&zonecode=" + zoneCode + "&resource=" + originalResource;

			$('#requestOut').html(urlSmartSwitch);

			function reloadRequest ()
			{
				$.ajax({
				  url: urlSmartSwitch,
				  context: document.body
				}).done(function(data) {
				  console.log(data);
				  $('#consoleOut').html(data);

				  var obj = jQuery.parseJSON(data);

				  $( "#resourcesOut" ).empty();
				  if (obj[1]) {
				  	$( "#resourcesOut" ).append( " - " + obj[1].URL + " (" + obj[1].CDN_CODE + ")<br />" );
				  }
				  if (obj[2]) {
				  	$( "#resourcesOut" ).append( " - " + obj[2].URL + " (" + obj[2].CDN_CODE + ")<br />" );
				  }
				  if (obj[3]) {
				  	$( "#resourcesOut" ).append( " - " + obj[3].URL + " (" + obj[3].CDN_CODE + ")<br />" );
				  }

				  youboraData.setMediaResource(obj[1].URL);
				  youboraData.setPropertyMetaTitle("CDN: " + obj[1].CDN_CODE);
				  loadPlayer(obj[1].URL);
				});
			}

			reloadRequest ();

			youboraData.setDebug(true);
			youboraData.setEnableAnalytics(true);
			youboraData.setEnableBalancer(false);

			youboraData.setContentId("new");
			youboraData.setResumeEnabled(false);

			youboraData.setConcurrencyCode("newCode");
			youboraData.setConcurrencyMaxCount(1);
			youboraData.setConcurrencyRedirectUrl("http://www.google.es");
			youboraData.concurrencyProperties.enabled=false;
			youboraData.setAccountCode(system);
			youboraData.setUsername('demosite jwplayer');
			youboraData.setService('http://nqs.nice264.com');
			youboraData.setTransaction('transIp');
			youboraData.setLive(false);
			youboraData.setProperties({
				filename: "SS_16_9_404p_1100_MP30/fc642fcbbf910bb50ffb.mp4",
				content_id: "fc642fcbbf910bb50ffb",
				content_metadata: {
					title: "NoTitle",
					genre: "Animation",
					language: "English",
					year: "2011",
					cast: "",
					director: "",
					owner: "nicepeopleatwork",
					duration: "09:27",
					parental: "",
					price: "0.0",
					rating: "",
					audioType: "",
					audioChannels: ""
				},
				transaction_type: "rental",
				quality: "SD",
				content_type: "movie",
				device: {
					manufacturer: "JWPlayer6",
					type: "Browser",
					year: "2014",
					firmware: ""
				}
			});


			function loadPlayer ( resource )
			{
				console.log ("Load Resource: " + resource);

				jwplayer("video_player").setup({
					autostart: "false",
					repeat: "false",
					type:"flash",
					file: resource,
					plugins: {
						"http://smartplugin.youbora.com/1.3/js/all-jwplayer/3.1.2/sp.js" :youboraData
					}
				})
			}

		</script>
	</body>
</html>

