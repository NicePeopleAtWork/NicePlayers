
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: api-ads.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="styles.css">
</head>

<body>

    <div id="main">

        <h1 class="page-title">Source: api-ads.js</h1>

        



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @license
 * Youbora AdsApi
 * Copyright NicePopleAtWork &lt;http://nicepeopleatwork.com/>
 */

/** AdsApi will help plugin class in the tracking and analyzing the Ad events. It also will help with the iteration with the Ads addons.
 *
 * @class Ads
 * @memberof $YB.api
 * @param {$YB.adnalyzers.Generic} adnalyzer The adnalyzer from where it was called.
 */
$YB.api.Ads = function(adnalyzer) { // constructor
    this.adnalyzer = adnalyzer;

    /** An instance of {@link $YB.utils.Buffer}. */
    this.buffer = new $YB.utils.Buffer(this);

    /** An object with multiples instances of {@link $YB.utils.Chrono}.
     * @prop {$YB.utils.Chrono} total Chrono for the totality of the Ad.
     * @prop {$YB.utils.Chrono} joinTime Chrono between ad start and joinTime.
     * @prop {$YB.utils.Chrono} pause Chrono for pauses.
     * @prop {$YB.utils.Chrono} buffer Reference to this.buffer.chrono
     */
    this.chrono = {
        total: new $YB.utils.Chrono(),
        joinTime: new $YB.utils.Chrono(),
        pause: new $YB.utils.Chrono(),
        buffer: this.buffer.chrono
    };

    /** Counters of rolls shown.
     * @prop {number} pre Prerolls shown.
     * @prop {number} mid midrolls shown.
     * @prop {number} post Postrolls shown.
     */
    this.counter = {
        pre: 0,
        mid: 0,
        post: 0,
        unknown: 0
    };

    /** Sum of preroll times. Useful to adecuate joinTime. */
    this.totalPrerollTime = 0;

    /** Position of the current roll: pre, mid, post, unknown. */
    this.position = '';
};

/**
 * Sends '/adStart' request.
 *
 * @param {Object} [params] Any parameter specified in this object will be sent along the AJAX request. The API will try to populate every param, so use this only if you need to override a specific param. Refer to the NQS API for more information.
 * @param {function} [callback] If defined, this callback will be called when de AJAX request is done successfully.
 */
$YB.api.Ads.prototype.sendAdStart = function(params, callback) {
    try {
        // Close previous view
        if (this.adnalyzer.isAdStartSent) {
            this.sendAdStop();
        }

        // Start autobuffer
        if (this.buffer.autostart) {
            this.buffer.start();
        }

        //If seeking or buffering, send /seek or /bufferUnderrun
        this.adnalyzer.plugin.videoApi.sendSeekEnd();
        this.adnalyzer.plugin.videoApi.sendBufferEnd();

        // Chronos &amp; Flags
        this.adnalyzer.plugin.isShowingAds = true;
        this.adnalyzer.isAdStartSent = true;
        this.chrono.total.start();
        this.chrono.joinTime.start();

        // Params
        params = params || {};
        params.resource = typeof params.resource != 'undefined' ? params.resource : this.adnalyzer.plugin.infoApi.getAdResource();
        params.position = typeof params.position != 'undefined' ? params.position : this.adnalyzer.plugin.infoApi.getAdPosition();
        params.number = typeof params.number != 'undefined' ? params.number : this.getNumber(params.position, true);
        params.campaign = typeof params.campaign != 'undefined' ? params.campaign : this.adnalyzer.plugin.data.ads.campaign;
        params.title = typeof params.title != 'undefined' ? params.title : this.adnalyzer.plugin.infoApi.getAdTitle();
        params.adDuration = typeof params.adDuration != 'undefined' ? params.adDuration : this.adnalyzer.plugin.infoApi.getAdDuration();
        params.playhead = typeof params.playhead != 'undefined' ? params.playhead : this.adnalyzer.plugin.infoApi.getPlayhead();
        params.adnalyzerVersion = typeof params.adnalyzerVersion != 'undefined' ? params.adnalyzerVersion : this.adnalyzer.adnalyzerVersion;
        params.adPlayerVersion = typeof params.adPlayerVersion != 'undefined' ? params.adPlayerVersion : this.adnalyzer.plugin.infoApi.getAdPlayerVersion();


        if (typeof params.durationJointime != 'undefined') {
            this.adnalyzer.isAdJoinSent = true;
        }

        this.position = params.position;

        // Send request
        this.adnalyzer.plugin.comm.sendRequest('/adStart', params, callback);
        $YB.notice("Request: NQS /adStart " + params.position + params.number, 'darkgreen');
    } catch (err) {
        $YB.error(err);
    }
};

/**
 * Sends '/adJoinTime' request.
 *
 * @param {Object} [params] Any parameter specified in this object will be sent along the AJAX request. The API will try to populate every param, so use this only if you need to override a specific param. Refer to the NQS API for more information.
 * @param {function} [callback] If defined, this callback will be called when de AJAX request is done successfully.
 */
$YB.api.Ads.prototype.sendAdJoin = function(params, callback) {
    try {
        if (this.adnalyzer.isAdStartSent &amp;&amp; !this.adnalyzer.isAdJoinSent) {
            this.adnalyzer.isAdJoinSent = true;

            if (this.buffer.autostart) {
                this.buffer.start();
            }

            // Params
            params = params || {};
            params.adPlayhead = typeof params.adPlayhead != 'undefined' ? params.adPlayhead : this.adnalyzer.plugin.infoApi.getAdPlayhead();
            params.duration = typeof params.duration != 'undefined' ? params.duration : this.chrono.joinTime.getDeltaTime();
            params.position = typeof params.position != 'undefined' ? params.position : this.position;
            params.number = typeof params.number != 'undefined' ? params.number : this.getNumber(params.position);

            // Send request
            this.adnalyzer.plugin.comm.sendRequest('/adJoinTime', params, callback);
            $YB.notice("Request: NQS /adJoinTime " + params.duration + "ms", 'darkgreen');
        }
    } catch (err) {
        $YB.error(err);
    }
};

/**
 * Sends '/adStop' request.
 *
 * @param {Object} [params] Any parameter specified in this object will be sent along the AJAX request. The API will try to populate every param, so use this only if you need to override a specific param. Refer to the NQS API for more information.
 * @param {function} [callback] If defined, this callback will be called when de AJAX request is done successfully.
 */
$YB.api.Ads.prototype.sendAdStop = function(params, callback) {
    try {
        if (this.adnalyzer.isAdStartSent) {
            this.adnalyzer.isAdStartSent = false;
            this.adnalyzer.isAdJoinSent = false;
            this.adnalyzer.isAdBuffering = false;
            this.adnalyzer.plugin.isShowingAds = false;

            this.buffer.stop();

            // Params
            params = params || {};
            params.totalDuration = typeof params.totalDuration != 'undefined' ? params.totalDuration : this.chrono.total.getDeltaTime();
            params.adPlayhead = typeof params.adPlayhead != 'undefined' ? params.adPlayhead : this.adnalyzer.plugin.infoApi.getAdPlayhead();
            params.adBitrate = typeof params.adBitrate != 'undefined' ? params.adBitrate : this.adnalyzer.plugin.infoApi.getAdBitrate();
            params.position = typeof params.position != 'undefined' ? params.position : this.position;
            params.number = typeof params.number != 'undefined' ? params.number : this.getNumber(params.position);

            if (!params.adPlayhead) {
                delete params.adPlayhead;
            }

            // Save preroll time
            if (this.position == 'pre' &amp;&amp; !this.adnalyzer.plugin.isJoinSent) {
                this.totalPrerollTime += params.totalDuration;
            }

            // Send request
            this.adnalyzer.plugin.comm.sendRequest('/adStop', params, callback);
            $YB.notice("Request: NQS /adStop " + params.totalDuration + "ms", 'darkgreen');
        }
    } catch (err) {
        $YB.error(err);
    }
};

/**
 * Sends '/adPause' request.
 *
 * @param {Object} [params] Any parameter specified in this object will be sent along the AJAX request. The API will try to populate every param, so use this only if you need to override a specific param. Refer to the NQS API for more information.
 * @param {function} [callback] If defined, this callback will be called when de AJAX request is done successfully.
 */
$YB.api.Ads.prototype.sendAdPause = function(params, callback) {
    try {
        if (this.adnalyzer.isAdJoinSent &amp;&amp; !this.adnalyzer.isAdPaused) {
            this.adnalyzer.isAdPaused = true;
            this.chrono.pause.start();

            // Params
            params = params || {};
            params.position = typeof params.position != 'undefined' ? params.position : this.position;
            params.number = typeof params.number != 'undefined' ? params.number : this.getNumber(params.position);

            // Send the request
            this.adnalyzer.plugin.comm.sendRequest('/adPause', params, callback);
            $YB.notice("Request: NQS /adPause", 'darkgreen');
        }
    } catch (err) {
        $YB.error(err);
    }
};


/**
 * Sends '/adResume' request.
 *
 * @param {Object} [params] Any parameter specified in this object will be sent along the AJAX request. The API will try to populate every param, so use this only if you need to override a specific param. Refer to the NQS API for more information.
 * @param {function} [callback] If defined, this callback will be called when de AJAX request is done successfully.
 */
$YB.api.Ads.prototype.sendAdResume = function(params, callback) {
    try {
        if (this.adnalyzer.isAdJoinSent &amp;&amp; this.adnalyzer.isAdPaused) {
            this.adnalyzer.isAdPaused = false;
            this.chrono.pause.getDeltaTime();

            // Params
            params = params || {};
            params.position = typeof params.position != 'undefined' ? params.position : this.position;
            params.number = typeof params.number != 'undefined' ? params.number : this.getNumber(params.position);

            // Send the request
            this.adnalyzer.plugin.comm.sendRequest('/adResume', params, callback);
            $YB.notice("Request: NQS /adResume", 'darkgreen');
        }
    } catch (err) {
        $YB.error(err);
    }
};


/** Notifies a buffer start. It will expect a {$YB.api.Ads#sendAdBufferEnd}. */
$YB.api.Ads.prototype.sendAdBufferStart = function() {
    try {
        if (this.adnalyzer.isAdJoinSent &amp;&amp; !this.adnalyzer.isAdBuffering) {
            this.adnalyzer.isAdBuffering = true;
            this.chrono.buffer.start();

            $YB.notice("Method: /adBufferStart", 'darkgreen');
        }
    } catch (err) {
        $YB.error(err);
    }
};

/**
 * Sends '/adBufferUnderr
un' request.
 *
 * @param {Object} [params] Any parameter specified in this object will be sent along the AJAX request. The API will try to populate every param, so use this only if you need to override a specific param. Refer to the NQS API for more information.
 * @param {function} [callback] If defined, this callback will be called when de AJAX request is done successfully.
 */
$YB.api.Ads.prototype.sendAdBufferEnd = function(params, callback) {
    try {
        if (this.adnalyzer.isAdJoinSent &amp;&amp; this.adnalyzer.isAdBuffering) {
            this.adnalyzer.isAdBuffering = false;

            params = params || {};
            params.adPlayhead = typeof params.adPlayhead != 'undefined' ? params.adPlayhead : this.adnalyzer.plugin.infoApi.getAdPlayhead();
            params.duration = typeof params.duration != 'undefined' ? params.duration : this.chrono.buffer.getDeltaTime();
            params.position = typeof params.position != 'undefined' ? params.position : this.position;
            params.number = typeof params.number != 'undefined' ? params.number : this.getNumber(params.position);

            // Send request
            this.adnalyzer.plugin.comm.sendRequest('/adBufferUnderrun', params, callback);
            $YB.notice("Request: NQS /adBufferUnderrun " + params.duration + "ms", 'darkgreen');
        }
    } catch (err) {
        $YB.error(err);
    }
};


/**
 * Given a position, it returns the counter of ads of that type.
 * @param {string} pos either 'pre', 'mid', 'post' or 'unknown'.
 * @param {boolean} [increment=false] If true, counter will be incremented before beign sent.
 */
$YB.api.Ads.prototype.getNumber = function(pos, increment) {
    switch (pos) {
        case 'pre':
            return (increment) ? ++this.counter.pre : this.counter.pre;
        case 'mid':
            return (increment) ? ++this.counter.mid : this.counter.mid;
        case 'post':
            return (increment) ? ++this.counter.post : this.counter.post;
        default:
            return (increment) ? ++this.counter.unknown : this.counter.unknown;
    }
};

/**
 * Restarts all the counters.
 */
$YB.api.Ads.prototype.resetNumbers = function() {
    this.counter = {
        pre: 0,
        mid: 0,
        post: 0,
        unknown: 0
    };
};
</code></pre>
        </article>
    </section>




    </div>

    <nav>
        <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="$YB.adnalyzers.Generic.html">$YB.adnalyzers.Generic</a></li><li><a href="$YB.api.Ads.html">$YB.api.Ads</a></li><li><a href="$YB.api.Info.html">$YB.api.Info</a></li><li><a href="$YB.api.Ping.html">$YB.api.Ping</a></li><li><a href="$YB.api.Video.html">$YB.api.Video</a></li><li><a href="$YB.comm.AjaxRequest.html">$YB.comm.AjaxRequest</a></li><li><a href="$YB.comm.Communication.html">$YB.comm.Communication</a></li><li><a href="$YB.data.Options.html">$YB.data.Options</a></li><li><a href="$YB.plugins.Generic.html">$YB.plugins.Generic</a></li><li><a href="$YB.services.ResourceParser.html">$YB.services.ResourceParser</a></li><li><a href="$YB.utils.Buffer.html">$YB.utils.Buffer</a></li><li><a href="$YB.utils.Chrono.html">$YB.utils.Chrono</a></li></ul><h3>Namespaces</h3><ul><li><a href="$YB.html">$YB</a></li><li><a href="$YB.adnalyzers.html">$YB.adnalyzers</a></li><li><a href="$YB.api.html">$YB.api</a></li><li><a href="$YB.comm.html">$YB.comm</a></li><li><a href="$YB.data.html">$YB.data</a></li><li><a href="$YB.plugins.html">$YB.plugins</a></li><li><a href="$YB.services.html">$YB.services</a></li><li><a href="$YB.utils.html">$YB.utils</a></li></ul>
    </nav>

    <div class="clear"></div>
    <footer>
        Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Fri Apr 22 2016 09:34:52 GMT+0200 (CEST)
    </footer>

    <script> prettyPrint(); </script>
    <script src="scripts/linenumber.js"> </script>
</body>
</html>