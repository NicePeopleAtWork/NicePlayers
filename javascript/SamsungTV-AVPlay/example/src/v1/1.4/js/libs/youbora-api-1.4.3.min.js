function YouboraCommunication(t,e,o,a,n,i){try{this.version="1.4.3",this.system=t,this.service=e,this.bandwidth=o,this.pluginVersion=a,this.targetDevice=n,this.outputFormat="xml",this.xmlHttp=null,this.isXMLReceived=!1,this.playerId=i,this.pamBufferUnderrunUrl="",this.pamSeekUrl="",this.pamJoinTimeUrl="",this.pamStartUrl="",this.pamStopUrl="",this.pamPauseUrl="",this.pamResumeUrl="",this.pamPingUrl="",this.pamErrorUrl="",this.pamAdsUrl="",this.pamCode="",this.pamCodeOrig="",this.pamCodeCounter=0,this.pamPingTime=5e3,this.lastPingTime=0,this.diffTime=0,this.canSendEvents=!1,this.eventQueue=[],this.startSent=!1,this.eventsQueueSent=!1,this.fastDataValid=!1,this.debug=this.getYouboraData().getDebug(),this.debugHost="";var s=this;this.concurrencyTimer="",this.resumeInterval="",this.currentTime=0,this.wasResumed=0,this.balancedUrlsCallback=function(){},this.balancedCallback=function(){},this.cdnNodeDataSendRequest=!1,this.cdnNodeDataRequestFinished=!1,this.checkM3U8=!1,this.nodeHostDataStart={host:"",type:""},this.l3types={UNKNOWN:0,TCP_HIT:1,TCP_MISS:2,TCP_MEM_HIT:3,TCP_IMS_HIT:4},this.l3IsNodeSend=!1,this.resourcePath="",this.protocol="http://",this.createXMLHttpRequest=function(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},this.getRealResourceHLS=function(t,e){try{var o=this,a=null;try{a=/\.([0-9a-zA-Z]+)(?:[\?#]|$)/.exec(t)[1].toLowerCase()}catch(n){}"m3u8"==a&&this.getYouboraData().getParseHLS()?(this.xmlHttp=this.createXMLHttpRequest(),this.xmlHttp.context=this,this.xmlHttp.open("GET",t,!0),arrayURL=t.split("/"),absoluteURL=t.replace(arrayURL[arrayURL.length-1],""),this.xmlHttp.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var a=this.responseText.split("\n"),n=t;for(var i in a){var s=/^https*:\/\/.*((\.m3u8|\.ts|\.mp4))/i.exec(a[i]);if(null!==s){n=a[i];break}}null!==/^https*:\/\/.*((\.ts|\.mp4))/i.exec(n)?o.getRealResourceHLS(n,e):(null===/^https*:\/\//i.exec(n)&&(n=absoluteURL+n),o.getRealResourceHLS(n,e))}},this.xmlHttp.send()):(this.getYouboraData().setCDNNodeDataObtained(!0),this.getYouboraData().setMediaResource(t),this.checkM3U8=!0,e())}catch(i){this.debug&&console.log("YouboraCommunication :: Error: HLSParser :: "+i)}},1==this.getYouboraData().getHttpSecure()&&(this.protocol="https://"),"undefined"!=typeof this.getYouboraData()?(this.getYouboraData().concurrencyProperties.enabled?(this.concurrencyTimer=setInterval(function(){s.checkConcurrencyWork()},1e4),this.debug&&console.log("YouboraCommunication :: Concurrency :: Enabled")):this.debug&&console.log("YouboraCommunication :: Concurrency :: Disabled"),this.getYouboraData().resumeProperties.resumeEnabled?(this.checkResumeState(),this.debug&&console.log("YouboraCommunication :: Resume :: Enabled")):this.debug&&console.log("YouboraCommunication :: Resume :: Disabled"),1==this.getYouboraData().cdn_node_data?this.debug&&console.log("YouboraCommunication :: Level3 :: Enabled"):this.debug&&console.log("YouboraCommunication :: Level3 :: Disabled"),this.getYouboraData().getBalanceEnabled()?this.debug&&console.log("YouboraCommunication :: Balancer :: Enabled"):this.debug&&console.log("YouboraCommunication :: Balancer :: Disabled")):this.debug&&console.log("YouboraCommunication :: Unable to reach this.getYouboraData() :: Concurrency / Resume / Level3 :: Disabled"),1==this.getYouboraData().getHttpSecure()&&(this.protocol="https://"),this.init()}catch(r){this.debug&&console.log("YouboraCommunication :: Error: "+r)}}function YouboraCommunicationURL(t,e){this.params=e,this.eventType=t}try{if(!window.console)var console={};console.log||(console.log=function(){})}catch(error){}YouboraCommunication.prototype.init=function(){try{this.xmlHttp=this.createXMLHttpRequest(),this.xmlHttp.context=this,this.xmlHttp.addEventListener("load",function(t){this.context.loadAnalytics(t)},!1),1==this.getYouboraData().getHttpSecure()&&(this.service=this.protocol+this.service.split("//")[1]);var t=this.service+"/data?system="+this.system+"&pluginVersion="+this.pluginVersion+"&targetDevice="+this.targetDevice+"&outputformat="+this.outputFormat;1==this.getYouboraData().getNqsDebugServiceEnabled()&&(t+="&nqsDebugServiceEnabled=true"),this.xmlHttp.open("GET",t,!0),this.xmlHttp.send(),this.resourceTreatment(),this.debug&&console.log("YouboraCommunication :: HTTP Fastdata Request :: "+t)}catch(e){this.debug&&console.log("YouboraCommunication :: Error Msg: "+e)}},YouboraCommunication.prototype.resourceTreatment=function(){try{var t=this;void 0!==this.getYouboraData().getMediaResource()&&""!==this.getYouboraData().getMediaResource()&&this.getRealResourceHLS(this.getYouboraData().getMediaResource(),function(){t.getYouboraData().getCDNNodeData()?t.getLevel3Header():(t.cdnNodeDataSendRequest=!0,t.cdnNodeDataRequestFinished=!0,t.sendEventsFromQueue())})}catch(e){this.debug&&console.log("YouboraCommunication :: resourceTratment "+e)}},YouboraCommunication.prototype.cdnNodeHostReady=function(){return 0==this.getYouboraData().cdn_node_data&&0==this.getYouboraData().parseHLS?!0:this.cdnNodeDataSendRequest&&this.cdnNodeDataRequestFinished?!0:!1},YouboraCommunication.prototype.cleanResource=function(t){return t.split("?")[0]},YouboraCommunication.prototype.getLevel3Header=function(){if("undefined"!=typeof this.getYouboraData()){if(0==this.getYouboraData().cdn_node_data)return;if(this.cdnNodeDataSendRequest)return;if(this.getYouboraData().getMediaResource().length>0)try{this.xmlHttp=this.createXMLHttpRequest(),this.xmlHttp.context=this,this.xmlHttp.addEventListener("load",function(t){try{var e=t.target.getResponseHeader("X-WR-DIAG").toString();this.context.parseL3Header(e,1)}catch(o){this.debug&&console.log("YouboraCommunication :: Level3 :: Error parsing header"+o),this.context.getAkamaiHeader()}},!0),this.xmlHttp.addEventListener("error",function(){this.context.getAkamaiHeader()},!0),this.xmlHttp.open("head",this.cleanResource(this.getYouboraData().getMediaResource()),!0),this.xmlHttp.setRequestHeader("X-WR-Diag","host"),this.xmlHttp.send(),this.cdnNodeDataSendRequest=!0,this.debug&&console.log("YouboraCommunication :: HTTP LEVEL3 Header Request :: "+this.getYouboraData().getMediaResource())}catch(t){this.debug&&console.log("YouboraCommunication :: Level3 :: Error with header, disabling header check"),this.context.getAkamaiHeader()}}},YouboraCommunication.prototype.parseL3Header=function(t){try{var e=t;return e=e.split(" "),e.host=e[0].replace("Host:",""),e.type=e[1].replace("Type:",""),"TCP_HIT"==e.type?e.type=this.l3types.TCP_HIT:"TCP_MISS"==e.type?e.type=this.l3types.TCP_MISS:"TCP_MEM_HIT"==e.type?e.type=this.l3types.TCP_MEM_HIT:"TCP_IMS_HIT"==e.type?e.type=this.l3types.TCP_IMS_HIT:(this.debug&&console.log("YouboraCommunication :: Level3 :: Unknown type received: "+e.type),e.type=this.l3types.UNKNOWN),this.nodeHostDataStart.host=e.host,this.nodeHostDataStart.type=e.type,this.debug&&console.log("YouboraCommunication :: Level3 :: onLoad :: Host: "+this.nodeHostDataStart.host+" :: Type: "+this.nodeHostDataStart.type),this.getYouboraData().setCDNNodeDataObtained(!0),this.cdnNodeDataRequestFinished=!0,this.sendEventsFromQueue(),!0}catch(o){return this.getYouboraData().setCDNNodeData(!1),this.debug&&console.log("YouboraCommunication :: Level3 :: Error with header, disabling header check"+o),this.cdnNodeDataRequestFinished=!0,this.sendEventsFromQueue(),!1}},YouboraCommunication.prototype.getAkamaiHeader=function(){try{if(0==this.getYouboraData().cdn_node_data)return;this.getYouboraData().getMediaResource().length>0&&(this.xmlHttp=this.createXMLHttpRequest(),this.xmlHttp.context=this,this.xmlHttp.addEventListener("load",function(t){try{this.context.parseAkamaiHeader(t.target.getResponseHeader("X-Cache"))}catch(e){this.debug&&console.log("YouboraCommunication :: Akamai :: Error parsing header"+e),this.getYouboraData().setCDNNodeData(!1),this.cdnNodeDataRequestFinished=!0,this.context.sendEventsFromQueue()}},!0),this.xmlHttp.addEventListener("error",function(){this.context.cdnNodeDataSendRequest=!0,this.context.cdnNodeDataRequestFinished=!0,this.context.sendEventsFromQueue()},!0),this.xmlHttp.open("head",this.cleanResource(this.getYouboraData().getMediaResource()),!0),this.xmlHttp.send(),this.cdnNodeDataSendRequest=!0)}catch(t){this.cdnNodeDataRequestFinished=!0,this.sendEventsFromQueue(),this.getYouboraData().setCDNNodeData(!1),this.debug&&console.log("YouboraCommunication :: Akamai :: Error with header, disabling header check")}},YouboraCommunication.prototype.parseAkamaiHeader=function(t){try{var e=t;return e=e.split(" "),e.type=e[0].replace("Type:",""),e.host=e[3].split("/")[1].replace(")",""),"TCP_HIT"==e.type?e.type=this.l3types.TCP_HIT:"TCP_MISS"==e.type?e.type=this.l3types.TCP_MISS:"TCP_MEM_HIT"==e.type?e.type=this.l3types.TCP_MEM_HIT:"TCP_IMS_HIT"==e.type?e.type=this.l3types.TCP_IMS_HIT:(this.debug&&console.log("YouboraCommunication :: Akamai :: Unknown type received: "+e.type),e.type=this.l3types.UNKNOWN),this.nodeHostDataStart.host=e.host,this.nodeHostDataStart.type=e.type,this.debug&&console.log("YouboraCommunication :: Akamai :: onLoad :: Host: "+this.nodeHostDataStart.host+" :: Type: "+this.nodeHostDataStart.type),this.cdnNodeDataRequestFinished=!0,this.sendEventsFromQueue(),!0}catch(o){return this.getYouboraData().setCDNNodeData(!1),this.cdnNodeDataRequestFinished=!0,this.sendEventsFromQueue(),this.debug&&console.log("YouboraCommunication :: Akamai :: Error with header, disabling header check"+o),!1}},YouboraCommunication.prototype.checkResumeState=function(){var t=this.getYouboraData().getResumeService(),e=this.getYouboraData().getContentId(),o=this.getYouboraData().getUsername();if(t=this.protocol+t.split("//")[1],this.getYouboraData().getResumeEnabled())if(e.length>0)if(o.length>0)try{this.xmlHttp=this.createXMLHttpRequest(),this.xmlHttp.context=this,this.xmlHttp.addEventListener("load",function(t){this.context.validateResumeStatus(t)},!1);var a=t+"?contentId="+e+"&userId="+o+"&random="+Math.random();this.xmlHttp.send(),this.debug&&console.log("YouboraCommunication :: checkResumeState :: HTTP Reusme Request :: "+a),this.debug&&console.log("YouboraCommunication :: checkResumeState :: Resume :: Enabled")}catch(n){clearInterval(this.resumeInterval),this.debug&&console.log("YouboraCommunication :: checkResumeState :: Error while performig resume petition ::"+n)}else this.debug&&console.log("YouboraCommunication :: checkResumeState :: Resume enabled without username defined :: Resume Disabled");else this.debug&&console.log("YouboraCommunication :: checkResumeState :: Resume enabled without contentId defined :: Resume Disabled");else this.debug&&console.log("YouboraCommunication :: checkResumeState :: Resume disabled in data. ")},YouboraCommunication.prototype.validateResumeStatus=function(httpEvent){try{if(4==httpEvent.target.readyState){var response=httpEvent.target.response.toString();if(response>0){var resumeCallback=this.getYouboraData().getResumeCallback();this.debug&&console.log("YouboraCommunication :: Resume :: Available ::"),"function"==typeof resumeCallback?(this.wasResumed=1,resumeCallback(response),this.debug&&console.log("YouboraCommunication :: Resume :: Executed Function")):"string"==typeof resumeCallback?eval(resumeCallback):this.debug&&console.log("YouboraCommunication :: Unable to determine callback type!")}else"0"==response?this.debug&&console.log("YouboraCommunication :: Resume :: No previous state..."):(clearInterval(this.resumeInterval),this.debug&&console.log("YouboraCommunication :: Resume :: Empty response... stoping rsume."))}}catch(error){clearInterval(this.resumeInterval),this.debug&&console.log("YouboraCommunication :: validateResumeStatus :: Error: "+error)}},YouboraCommunication.prototype.sendPlayTimeStatus=function(){var t=this.getYouboraData().getPlayTimeService(),e=this.getYouboraData().getContentId(),o=this.getYouboraData().getUsername();t=this.protocol+t.split("//")[1];try{if(this.getYouboraData().getResumeEnabled()){this.xmlHttp=this.createXMLHttpRequest(),this.xmlHttp.addEventListener("load",function(){},!1);var a=t+"?contentId="+e+"&userId="+o+"&playTime="+Math.round(this.currentTime)+"&random="+Math.random();this.xmlHttp.open("GET",a,!0),this.xmlHttp.send(),this.debug&&console.log("YouboraCommunication :: HTTP Resume Request :: "+a)}else this.debug&&console.log("YouboraCommunication :: sendPlayTimeStatus :: Resume disabled in data.")}catch(n){clearInterval(this.resumeInterval),this.debug&&console.log("YouboraCommunication :: sendPlayTimeStatus :: Error: "+n)}},YouboraCommunication.prototype.enableResume=function(){try{this.getYouboraData().setResumeEnabled(!0);var t=this;clearInterval(this.resumeInterval),this.resumeInterval=setInterval(function(){t.sendPlayTimeStatus()},6e3),this.checkResumeState(),this.debug&&console.log("YouboraCommunication :: enableResume :: Resume is now enabled")}catch(e){clearInterval(this.resumeInterval),this.debug&&console.log("YouboraCommunication :: enableResume :: Error: "+e)}},YouboraCommunication.prototype.disableResume=function(){try{this.getYouboraData().setResumeEnabled(!1),clearInterval(this.resumeInterval),this.debug&&console.log("YouboraCommunication :: disableResume :: Resume is now disabled")}catch(t){clearInterval(this.resumeInterval),this.debug&&console.log("YouboraCommunication :: disableResume :: Error: "+t)}},YouboraCommunication.prototype.getPingTime=function(){return this.pamPingTime},YouboraCommunication.prototype.sendStartL3=function(t,e,o,a,n,i,s){this.sendStart(t,e,o,a,n,i,s)},YouboraCommunication.prototype.sendStart=function(t,e,o,a,n,i,s){try{(void 0==s||"undefined"==s||""==s)&&(s=this.getYouboraData().getTransaction()),(void 0==i||"undefined"==i)&&(i=0),this.bandwidth.username=this.getYouboraData().getUsername(),void 0!=n&&""!=n?this.resourceTreatment():this.getYouboraData().setCDNNodeData(!1);var r=new Date,u="?pluginVersion="+this.pluginVersion+"&pingTime="+this.pamPingTime/1e3+"&totalBytes="+t+"&referer="+encodeURIComponent(e)+"&user="+this.bandwidth.username+"&properties="+encodeURIComponent(JSON.stringify(this.getYouboraData().getProperties()))+"&live="+a+"&transcode="+s+"&system="+this.system+"&duration="+i;if(u+=this.getExtraParamsUrl(this.getYouboraData().getExtraParams()),u+=this.getYouboraData().isBalanced?"&isBalanced=1":"&isBalanced=0",u+=this.getYouboraData().hashTitle?"&hashTitle=true":"&hashTitle=false",""!=this.getYouboraData().getCDN()&&(u+="&cdn="+this.getYouboraData().getCDN()),""!=this.getYouboraData().getISP()&&(u+="&isp="+this.getYouboraData().getISP()),""!=this.getYouboraData().getIP()&&(u+="&ip="+this.getYouboraData().getIP()),u+="&isResumed="+this.wasResumed,this.canSendEvents&&this.cdnNodeHostReady()?this.sendAnalytics(this.pamStartUrl,u,!1):this.addEventToQueue(YouboraCommunicationEvents.START,u),this.getYouboraData().getResumeEnabled()){var c=this;this.debug&&console.log("YouboraCommunication :: Resume :: Enabled"),this.sendPlayTimeStatus(),this.resumeInterval=setInterval(function(){c.sendPlayTimeStatus()},6e3)}this.startSent=!0,this.lastPingTime=r.getTime()}catch(h){this.debug&&console.log("YouboraCommunication :: sendStart :: "+h)}},YouboraCommunication.prototype.sendError=function(t,e){try{var o="";o="undefined"!=typeof t&&parseInt(t)>=0?"?errorCode="+t+"&msg="+e:"?errorCode=9000&msg="+e,this.canSendEvents&&this.cdnNodeHostReady()?this.sendAnalytics(this.pamErrorUrl,o,!1):this.addEventToQueue(YouboraCommunicationEvents.ERROR,o)}catch(a){this.debug&&console.log("YouboraCommunication :: sendError :: "+a)}},YouboraCommunication.prototype.sendErrorWithParameters=function(t,e,o,a,n,i,s,r){try{("undefined"==typeof t||parseInt(t)<0)&&(t=9e3);var u="?errorCode="+t+"&msg="+e;u+=this.createParamsUrl(o,a,i,s,r),this.canSendEvents&&this.cdnNodeHostReady()?this.sendAnalytics(this.pamErrorUrl,u,!1):this.addEventToQueue(YouboraCommunicationEvents.ERROR,u)}catch(c){this.debug&&console.log("YouboraCommunication :: Error Msg: "+c)}},YouboraCommunication.prototype.sendAdvancedError=function(t,e,o,a,n,i,s,r,u){try{var c="?errorCode="+encodeURIComponent(t)+"&msg="+encodeURIComponent(o);c+="&player="+e,c+=this.createParamsUrl(a,n,s,r,u),this.canSendEvents&&this.cdnNodeHostReady()?this.sendAnalytics(this.pamErrorUrl,c,!1):this.addEventToQueue(YouboraCommunicationEvents.ERROR,c)}catch(h){this.debug&&console.log("YouboraCommunication :: sendAdvancedError :: "+h)}},YouboraCommunication.prototype.createParamsUrl=function(t,e,o,a,n){try{var i=this.getYouboraData().getTransaction();(void 0==n||"undefined"==n)&&(n=0),this.bandwidth.username=this.getYouboraData().getUsername();var s=(new Date,"&pluginVersion="+this.pluginVersion+"&pingTime="+this.pamPingTime/1e3+"&totalBytes="+t+"&referer="+encodeURIComponent(e)+"&user="+this.bandwidth.username+"&properties="+encodeURIComponent(JSON.stringify(this.getYouboraData().getProperties()))+"&live="+o+"&transcode="+i+"&system="+this.system+"&resource="+encodeURIComponent(a)+"&duration="+n);return s+=this.getExtraParamsUrl(this.getYouboraData().getExtraParams()),s+=this.getYouboraData().isBalanced?"&isBalanced=1":"&isBalanced=0",s+=this.getYouboraData().hashTitle?"&hashTitle=true":"&hashTitle=false",""!=this.getYouboraData().getCDN()&&(s+="&cdn="+this.getYouboraData().getCDN()),""!=this.getYouboraData().getISP()&&(s+="&isp="+this.getYouboraData().getISP()),""!=this.getYouboraData().getIP()&&(s+="&ip="+this.getYouboraData().getIP()),s}catch(r){this.debug&&console.log("YouboraCommunication :: Error Msg: "+r)}return""},YouboraCommunication.prototype.sendPingTotalBytes=function(t,e){try{if(0==this.startSent)return;e>0&&(this.currentTime=e);var o=new Date;0!=this.lastPingTime&&(this.diffTime=o.getTime()-this.lastPingTime),this.lastPingTime=o.getTime();var a="?diffTime="+this.diffTime+"&totalBytes="+t+"&pingTime="+this.pamPingTime/1e3+"&dataType=0&time="+e;this.canSendEvents&&this.cdnNodeHostReady()?this.sendAnalytics(this.pamPingUrl,a,!0):this.addEventToQueue(YouboraCommunicationEvents.PING,a)}catch(n){this.debug&&console.log("YouboraCommunication :: Error Msg: "+n)}},YouboraCommunication.prototype.sendPingTotalBitrate=function(t,e){try{if(0==this.startSent)return;e>0&&(this.currentTime=e);var o=new Date;0!=this.lastPingTime&&(this.diffTime=o.getTime()-this.lastPingTime),this.lastPingTime=o.getTime();var a="?diffTime="+this.diffTime+"&bitrate="+t+"&pingTime="+this.pamPingTime/1e3+"&time="+e;this.canSendEvents&&this.cdnNodeHostReady()?this.sendAnalytics(this.pamPingUrl,a,!0):this.addEventToQueue(YouboraCommunicationEvents.PING,a)}catch(n){this.debug&&console.log("YouboraCommunication :: Error Msg: "+n)}},YouboraCommunication.prototype.sendJoin=function(t,e){try{t>0&&(this.currentTime=t);var o="?eventTime="+t+"&time="+e;this.canSendEvents&&this.cdnNodeHostReady()?(this.sendEventsFromQueue(),this.sendAnalytics(this.pamJoinTimeUrl,o,!1)):this.addEventToQueue(YouboraCommunicationEvents.JOIN,o)}catch(a){this.debug&&console.log("YouboraCommunication :: Error Msg: "+a)}},YouboraCommunication.prototype.sendJoinWithMediaDuration=function(t,e,o){try{t>0&&(this.currentTime=t);var a="?eventTime="+t+"&time="+e+"&mediaDuration="+o;this.canSendEvents&&this.cdnNodeHostReady()?this.sendAnalytics(this.pamJoinTimeUrl,a,!1):this.addEventToQueue(YouboraCommunicationEvents.JOIN,a)}catch(n){this.debug&&console.log("YouboraCommunication :: Error Msg: "+n)}},YouboraCommunication.prototype.sendBuffer=function(t,e){try{if(0==this.startSent)return;t>0&&(this.currentTime=t);try{10>t&&this.getYouboraData().getLive()&&(t=10)}catch(o){}var a=null;a="?time="+t+"&duration="+e,this.canSendEvents&&this.cdnNodeHostReady()?this.sendAnalytics(this.pamBufferUnderrunUrl,a,!1):this.addEventToQueue(YouboraCommunicationEvents.BUFFER,a)}catch(o){this.debug&&console.log("YouboraCommunication :: Error Msg: "+o)}},YouboraCommunication.prototype.sendAds=function(t,e){try{if(0==this.startSent)return;t>0&&(this.currentTime=t);var o="?time="+t+"&duration="+e;this.canSendEvents&&this.cdnNodeHostReady()?this.sendAnalytics(this.pamAdsUrl,o,!1):this.addEventToQueue(YouboraCommunicationEvents.ADS,o)}catch(a){this.debug&&console.log("YouboraCommunication :: Error Msg: "+a)}},YouboraCommunication.prototype.sendSeek=function(t,e){try{if(0==this.startSent)return;t>0&&(this.currentTime=t);try{10>t&&this.getYouboraData().getLive()&&(t=10)}catch(o){}var a=null;a="?time="+t+"&duration="+e,this.canSendEvents&&this.cdnNodeHostReady()?this.sendAnalytics(this.pamSeekUrl,a,!1):this.addEventToQueue(YouboraCommunicationEvents.SEEK,a)}catch(o){this.debug&&console.log("YouboraCommunication :: Error Msg: "+o)}},YouboraCommunication.prototype.sendResume=function(){try{if(0==this.startSent)return;var t="";this.canSendEvents&&this.cdnNodeHostReady()?this.sendAnalytics(this.pamResumeUrl,t,!1):this.addEventToQueue(YouboraCommunicationEvents.RESUME,t)}catch(e){this.debug&&console.log("YouboraCommunication :: Error Msg: "+e)}},YouboraCommunication.prototype.sendPause=function(){try{if(0==this.startSent)return;var t="";this.canSendEvents&&this.cdnNodeHostReady()?this.sendAnalytics(this.pamPauseUrl,t,!1):this.addEventToQueue(YouboraCommunicationEvents.PAUSE,t),this.getYouboraData().getResumeEnabled()&&this.sendPlayTimeStatus()}catch(e){this.debug&&console.log("YouboraCommunication :: Error Msg: "+e)}},YouboraCommunication.prototype.sendStop=function(){try{if(0==this.startSent)return;this.currentTime=0,this.getYouboraData().getResumeEnabled()&&this.sendPlayTimeStatus(),clearInterval(this.resumeInterval);var t="?diffTime="+this.diffTime;this.canSendEvents&&this.cdnNodeHostReady()?this.sendAnalytics(this.pamStopUrl,t,!1):this.addEventToQueue(YouboraCommunicationEvents.STOP,t),this.reset()}catch(e){this.debug&&console.log("YouboraCommunication :: Error Msg: "+e)}},YouboraCommunication.prototype.sendStopResumeSafe=function(){try{if(0==this.startSent)return;clearInterval(this.resumeInterval);var t="?diffTime="+this.diffTime;this.canSendEvents&&this.cdnNodeHostReady()?this.sendAnalytics(this.pamStopUrl,t,!1):this.addEventToQueue(YouboraCommunicationEvents.STOP,t),this.reset()}catch(e){this.debug&&console.log("YouboraCommunication :: Error Msg: "+e)}},YouboraCommunication.prototype.addEventToQueue=function(t,e){try{var o=new YouboraCommunicationURL(t,e);this.eventQueue.push(o)}catch(a){this.debug&&console.log("YouboraCommunication :: Error Msg: "+a)}},YouboraCommunication.prototype.checkConcurrencyWork=function(){try{var t=this.getYouboraData().getConcurrencyCode(),e=this.getYouboraData().getAccountCode(),o=this.getYouboraData().getConcurrencyService(),a=this.getYouboraData().getConcurrencySessionId(),n=this.getYouboraData().getConcurrencyMaxCount(),i=this.getYouboraData().getConcurrencyIpMode(),s="";if(o=this.protocol+o.split("//")[1],this.getYouboraData().getConcurrencyEnabled()){var r=this;i?(this.xmlHttp=this.createXMLHttpRequest(),this.xmlHttp.addEventListener("load",function(t){r.validateConcurrencyResponse(t)},!1),s=o+"?concurrencyCode="+t+"&accountCode="+e+"&concurrencyMaxCount="+n+"&random="+Math.random(),this.xmlHttp.open("GET",s,!0),this.xmlHttp.send()):(this.xmlHttp=this.createXMLHttpRequest(),this.xmlHttp.addEventListener("load",function(t){r.validateConcurrencyResponse(t)},!1),s=o+"?concurrencyCode="+t+"&accountCode="+e+"&concurrencySessionId="+a+"&concurrencyMaxCount="+n+"&random="+Math.random(),this.xmlHttp.open("GET",s,!0),this.xmlHttp.send()),this.debug&&console.log("YouboraCommunication :: HTTP Concurrency Request :: "+s)}else this.debug&&console.log("YouboraCommunication :: HTTP Concurrency Request :: "+s)}catch(u){this.debug&&console.log("YouboraCommunication :: startConcurrencyWork :: Disabled in data.")}},YouboraCommunication.prototype.validateConcurrencyResponse=function(t){try{if(4==t.target.readyState){var e=t.target.response;if("1"==e){this.sendError(14e3,"CC_KICK");var o=this.getYouboraData().getConcurrencyRedirectUrl();"function"==typeof o?(this.debug&&console.log("YouboraCommunication :: Concurrency :: Executed function"),o()):(this.debug&&console.log("YouboraCommunication :: Concurrency :: 1 :: Redirecting to: "+o),window.location=o)}else"0"==e?this.debug&&console.log("YouboraCommunication :: Concurrency :: 0 :: Continue..."):(this.debug&&console.log("YouboraCommunication :: Concurrency :: Empty response... stoping validation."),clearInterval(this.concurrencyTimer))}}catch(a){this.debug&&console.log("YouboraCommunication :: validateConcurrencyResponse :: Error: "+a)}},YouboraCommunication.prototype.enableConcurrency=function(){try{this.getYouboraData().setConcurrencyEnabled(!0);var t=this;clearInterval(this.concurrencyTimer),this.concurrencyTimer=setInterval(function(){t.checkConcurrencyWork()},1e4),this.checkConcurrencyWork(),this.debug&&console.log("YouboraCommunication :: enableConcurrency :: Concurrency is now enabled")}catch(e){clearInterval(this.resumeInterval),this.debug&&console.log("YouboraCommunication :: enableConcurrency :: Error: "+e)}},YouboraCommunication.prototype.disableConcurrency=function(){try{this.getYouboraData().setConcurrencyEnabled(!1),clearInterval(this.concurrencyTimer),this.debug&&console.log("YouboraCommunication :: disableConcurrency :: Concurrency is now disabled")}catch(t){clearInterval(this.resumeInterval),this.debug&&console.log("YouboraCommunication :: disableConcurrency :: Error: "+t)}},YouboraCommunication.prototype.loadAnalytics=function(t){var e=this;try{if(4==t.target.readyState){this.debug&&console.log("YouboraCommunication :: Loaded XML FastData");var o,a=t.target.responseXML;try{o=a.getElementsByTagName("h")[0].childNodes[0].nodeValue}catch(n){this.debug&&console.log("YouboraCommunication :: loadAnalytics :: Invalid Fast-Data Response!")}void 0!=o&&""!=o&&(this.pamBufferUnderrunUrl=this.protocol+o+"/bufferUnderrun",this.pamSeekUrl=this.protocol+o+"/seek",this.pamJoinTimeUrl=this.protocol+o+"/joinTime",this.pamStartUrl=this.protocol+o+"/start",this.pamStopUrl=this.protocol+o+"/stop",this.pamPauseUrl=this.protocol+o+"/pause",this.pamResumeUrl=this.protocol+o+"/resume",this.pamPingUrl=this.protocol+o+"/ping",this.pamErrorUrl=this.protocol+o+"/error",this.pamAdsUrl=this.protocol+o+"/ads");try{this.pamCode=a.getElementsByTagName("c")[0].childNodes[0].nodeValue,this.pamCodeOrig=this.pamCode,this.pamPingTime=1e3*a.getElementsByTagName("pt")[0].childNodes[0].nodeValue,this.isXMLReceived=!0,this.enableAnalytics=!0,this.debug&&console.log("YouboraCommunication :: Mandatory :: Analytics Enabled")}catch(n){this.enableAnalytics=!1,this.debug&&console.log("YouboraCommunication :: Mandatory :: Analytics Disabled")}try{this.enableBalancer=a.getElementsByTagName("b")[0].childNodes[0].nodeValue,1==this.enableBalancer?(this.enableBalancer=!0,this.debug&&console.log("YouboraCommunication :: Mandatory :: Balancer Enabled")):(this.enableBalancer=!1,this.debug&&console.log("YouboraCommunication :: Mandatory :: Balancer Disabled"))}catch(n){this.debug&&console.log("YouboraCommunication :: Mandatory :: Balancer Disabled"),this.enableBalancer=!1}this.getYouboraData().enableAnalytics&&(this.canSendEvents=!0),void 0!=o&&""!=o&&void 0!=this.pamCode&&""!=this.pamCode&&(this.fastDataValid=!0),this.sendEventsFromQueue();try{e.debug=a.getElementsByTagName("db")[0].childNodes[0].nodeValue}catch(n){}try{e.debugHost=a.getElementsByTagName("dh")[0].childNodes[0].nodeValue}catch(n){e.debugHost=""}e.debugHost.length>0&&(this.debug&&console.log("YouboraCommunication :: replaceConsoleEvents :: Binding to: "+this.debugHost),this.replaceConsoleEvents(),this.getYouboraData().setDebug(!0)),this.resourceTreatment(),this.getYouboraData().concurrencyProperties.enabled&&this.fastDataValid&&this.checkConcurrencyWork()}}catch(n){this.debug&&console.log("YouboraCommunication :: loadAnalytics :: Error: "+n)}},YouboraCommunication.prototype.cPing=function(){try{this.xmlHttp=this.createXMLHttpRequest(),this.xmlHttp.context=this,this.xmlHttp.addEventListener("load",function(t){this.context.loadAnalytics(t)},!1);var t=this.service+"/data?system="+this.system+"&pluginVersion="+this.pluginVersion+"&targetDevice="+this.targetDevice+"&outputformat="+this.outputFormat;this.xmlHttp.open("GET",t,!0),this.xmlHttp.send(),this.debug&&console.log("YouboraCommunication :: HTTP Request :: "+t)}catch(e){this.debug&&console.log("YouboraCommunication :: cPing :: "+e)}},YouboraCommunication.prototype.replaceConsoleEvents=function(){try{var t=this;console={log:function(e){try{var o,a=new Date,n="["+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()+"]";o=this.createXMLHttpRequest(),o.open("GET",t.debugHost+encodeURIComponent(n)+" |> "+e),o.send()}catch(i){}}},this.debug&&console.log("YouboraCommunication :: replaceConsoleEvents :: Done ::")}catch(e){this.debug&&console.log("YouboraCommunication :: replaceConsoleEvents :: Error: "+e)}},YouboraCommunication.prototype.sendEventsFromQueue=function(){try{if(this.canSendEvents&&this.cdnNodeHostReady()&&0==this.eventsQueueSent){this.eventsQueueSent=!0;for(var t,e,o,a=this.eventQueue.shift();null!=a;)e=a.getEventType(),o=a.getParams(),e==YouboraCommunicationEvents.START?t=this.pamStartUrl:e==YouboraCommunicationEvents.JOIN?t=this.pamJoinTimeUrl:e==YouboraCommunicationEvents.BUFFER?t=this.pamBufferUnderrunUrl:e==YouboraCommunicationEvents.SEEK?t=this.pamSeekUrl:e==YouboraCommunicationEvents.PAUSE?t=this.pamPauseUrl:e==YouboraCommunicationEvents.RESUME?t=this.pamResumeUrl:e==YouboraCommunicationEvents.PING?t=this.pamPingUrl:e==YouboraCommunicationEvents.STOP?t=this.pamStopUrl:e==YouboraCommunicationEvents.ERROR&&(t=this.pamErrorUrl),null!=t&&this.sendAnalytics(t,o,!1),a=this.eventQueue.shift()}}catch(n){this.debug&&console.log("YouboraCommunication :: Error Msg: "+n)}},YouboraCommunication.prototype.getBalancerUrls=function(t,e){try{var o=this;if(this.balancedUrlsCallback=e,this.getYouboraData().enableBalancer){if("undefined"!=typeof this.getYouboraData()){var a=this.getYouboraData().getBalanceService(),n=this.getYouboraData().getBalanceType(),i=this.getYouboraData().getBalanceZoneCode(),s=this.getYouboraData().getBalanceOriginCode(),r=this.getYouboraData().getAccountCode(),u=(this.getYouboraData().getBalanceToken(),this.pluginVersion,this.getYouboraData().getBalanceNVA()),c=this.getYouboraData().getBalanceNVB(),h=this.getYouboraData().getLive();this.xmlHttp=this.createXMLHttpRequest(),this.xmlHttp.context=this;var m=a+"?type="+n+"&systemcode="+r+"&zonecode="+i+"&session="+this.pamCode+"&origincode="+s+"&resource="+encodeURIComponent(t)+"&niceNva="+u+"&niceNvb="+c+"&live="+h+"&token="+this.getYouboraData().getBalanceToken();try{1==h&&(m+="&live=true")}catch(d){}this.xmlHttp.addEventListener("load",function(t){var e=t.target.response.toString(),a="",n=!1;try{a=JSON.parse(e)}catch(i){n=!0}if(0==n)try{var s=[],r=0;for(varindex in e)try{r++,s[index]=a[r].URL}catch(i){}o.balancedUrlsCallback(s)}catch(i){o.balancedUrlsCallback(!1)}else o.balancedUrlsCallback(!1)},!1),this.xmlHttp.open("GET",m,!0),this.xmlHttp.send(),this.debug&&console.log("YouboraCommunication :: HTTP GetBalancerUrls Request :: "+m)}}else o.balancedUrlsCallback(!1)}catch(l){this.debug&&console.log("YouboraCommunication :: getBalancerUrls :: Error: "+l)}},YouboraCommunication.prototype.getBalancedResource=function(t,e){try{var o=this;if(o.getYouboraData().getBalanceEnabled()){o.balancedCallback=e;var a=o.getYouboraData().getBalanceService(),n=o.getYouboraData().getBalanceType(),i=o.getYouboraData().getBalanceZoneCode(),s=o.getYouboraData().getBalanceOriginCode(),r=o.getYouboraData().getAccountCode(),u=(o.getYouboraData().getBalanceToken(),o.pluginVersion,o.getYouboraData().getBalanceNVA()),c=o.getYouboraData().getBalanceNVB(),h=o.getYouboraData().getLive();this.resourcePath=t,this.xmlHttp=this.createXMLHttpRequest(),this.xmlHttp.context=this;var m=a+"?type="+n+"&systemcode="+r+"&session="+this.pamCode+"&zonecode="+i+"&origincode="+s+"&resource="+encodeURIComponent(t)+"&niceNva="+u+"&niceNvb="+c+"&token="+o.getYouboraData().getBalanceToken();try{1==h&&(m+="&live=true")}catch(d){}this.xmlHttp.addEventListener("load",function(t){var e=t.target.response.toString(),a="",n=!1;
try{a=JSON.parse(e)}catch(i){n=!0}0==n?(o.getYouboraData().extraParams.param13=!0,o.balancedCallback(a)):o.balancedCallback(!1)},!1),this.xmlHttp.open("GET",m,!0),this.xmlHttp.send(),this.debug&&console.log("YouboraCommunication :: HTTP Balance Request :: "+m)}else o.balancedCallback(!1)}catch(l){this.debug&&console.log("YouboraCommunication :: getBalancedResource :: Error: "+l)}},YouboraCommunication.prototype.validateBalanceResponse=function(t){try{4==t.target.readyState}catch(e){this.debug&&console.log("YouboraCommunication :: validateBalanceResponse :: Error: "+e)}},YouboraCommunication.prototype.sendAnalytics=function(t,e,o){try{if(this.canSendEvents&&this.fastDataValid){this.xmlHttp=this.createXMLHttpRequest(),this.xmlHttp.context=this,o?(this.xmlHttp.addEventListener("load",function(t){this.context.parseAnalyticsResponse(t)},!1),this.xmlHttp.addEventListener("error",function(){this.context.sendAnalyticsFailed()},!1)):(this.xmlHttp.addEventListener("load",function(t){this.context.parseAnalyticsResponse(t)},!1),this.xmlHttp.addEventListener("error",function(){this.context.sendAnalyticsFailed()},!1));var a="";a=""!=e?t+e+"&code="+this.pamCode+"&random="+Math.random():t+"?code="+this.pamCode+"&random="+Math.random(),-1!=t.indexOf(this.pamStartUrl)&&(a+="&resource="+encodeURIComponent(this.getYouboraData().getMediaResource())),-1!=t.indexOf(this.pamStartUrl)&&""!=this.nodeHostDataStart.host&&""!=this.nodeHostDataStart.type&&(a+="&nodeHost="+this.nodeHostDataStart.host+"&nodeType="+this.nodeHostDataStart.type),this.debug&&console.log("YouboraCommunication :: HTTP Request :: "+a),this.xmlHttp.open("GET",a,!0),this.xmlHttp.send()}}catch(n){this.debug&&console.log("YouboraCommunication :: Error Msg: "+n)}},YouboraCommunication.prototype.parseAnalyticsResponse=function(t){try{4==t.target.readyState}catch(e){this.debug&&console.log("YouboraCommunication :: parseAnalyticsResponse :: Error: "+e)}},YouboraCommunication.prototype.sendAnalyticsFailed=function(){try{this.debug&&console.log("YouboraCommunication :: Failed communication with nQs Service")}catch(t){this.debug&&console.log("YouboraCommunication :: sendAnalyticsFailed :: Error: "+t)}},YouboraCommunication.prototype.updateCode=function(){try{this.pamCodeCounter++,this.pamCode=this.pamCodeOrig+"_"+this.pamCodeCounter}catch(t){this.debug&&console.log("YouboraCommunication :: updateCode :: Error: "+t)}},YouboraCommunication.prototype.reset=function(){try{this.lastPingTime=0,this.diffTime=0,this.startSent=!1,this.nodeHostDataStart.host="",this.nodeHostDataStart.type="",this.cdnNodeDataSendRequest=!1,this.cdnNodeDataRequestFinished=!1,this.checkM3U8=!1,this.eventsQueueSent=!1,this.updateCode(),this.getYouboraData().setMediaResource("")}catch(t){this.debug&&console.log("YouboraCommunication :: reset Error: "+t)}},YouboraCommunication.prototype.getResourcePath=function(t){var e=t.split("//")[1],o=e.indexOf("/"),a=e.substring(o,t.length);return a},YouboraCommunication.prototype.getExtraParamsUrl=function(t){var e="";return void 0!=t&&(void 0!=t.extraparam1&&(e+="&param1="+t.extraparam1),void 0!=t.extraparam2&&(e+="&param2="+t.extraparam2),void 0!=t.extraparam3&&(e+="&param3="+t.extraparam3),void 0!=t.extraparam4&&(e+="&param4="+t.extraparam4),void 0!=t.extraparam5&&(e+="&param5="+t.extraparam5),void 0!=t.extraparam6&&(e+="&param6="+t.extraparam6),void 0!=t.extraparam7&&(e+="&param7="+t.extraparam7),void 0!=t.extraparam8&&(e+="&param8="+t.extraparam8),void 0!=t.extraparam9&&(e+="&param9="+t.extraparam9),void 0!=t.extraparam10&&(e+="&param10="+t.extraparam10)),e},YouboraCommunication.prototype.informEvent=function(t){var e="http://nqs5.pam.nice264.com:8991/playerEvent";time=(new Date).getTime(),code=this.pamCode;var o="?code="+code+"&time="+time+"&eventType="+t,a=e+o;this.xmlHttp=this.createXMLHttpRequest(),this.xmlHttp.context=this,this.debug&&console.log("YouboraCommunication :: HTTP Request :: "+a),this.xmlHttp.open("GET",a,!0),this.xmlHttp.send()},YouboraCommunication.prototype.getYouboraData=function(){try{return"undefined"!=typeof youboraDataMap?("undefined"==typeof this.playerId&&(this.playerId="yb_player"),youboraDataMap.get(this.playerId)):youboraData}catch(t){this.debug&&console.log("YouboraCommunication :: getYouboraData :: "+t)}},YouboraCommunicationURL.prototype.getParams=function(){return this.params},YouboraCommunicationURL.prototype.getEventType=function(){return this.eventType};var YouboraCommunicationEvents={START:0,JOIN:1,BUFFER:2,PING:3,PAUSE:4,RESUME:5,STOP:6,ERROR:7,SEEK:8};
