videojs.plugin("youbora",function(e){var r=this,t=this.id(),a=e,o="";o="undefined"==typeof youboraDataMap?youboraData:youboraDataMap.get(t);var n=o.getDebug(),c=o.getLive(),i={username:o.getUsername(),interval:6e3},s="PC-VIDEOJS",l="VIDEOJS",u="1.4.3.4.2-vjs-bc-fw_videojs";r.mediainfo&&(s="PC-VIDEOJS-BCOVE",l="BCOVE",u="1.4.3.4.2-vjs-bc-fw_bcovevjs ");var d=0,g="",m=1,f={BUFFER_BEGIN:1,BUFFER_END:0,JOIN_SEND:2},p=this,b=void 0,y=void 0,h=void 0,P=0,E=0,S=0,B="",v=!1,k=!1,R=!1,C=!1,w=!1,T=!1,D=!1,N=!1,x=!1,F=!1,L=!1,U=!1,I=!1,_=!1,j=!1,O=0,A=0,M=0,W=0,J="",G="",H=!1,V=0,Y=.1,q={},z=0,K={1:"11100",2:"11101",3:"11102",4:"11103",5:"11104",unknown:"11105","-1":"11106","-2":"11107"};this.youbora={Check:function(){console.log("i am "),console.log(r)},Init:function(){d=!0,r.youbora.startPlugin()},getYouboraData:function(){return o},setBcoveProperties:function(e){try{!v&&(1/0===E||0>E)&&o.setLive(!0)}catch(t){}try{r.mediainfo&&(e.properties||(e.properties=""),e.properties.content_metadata||(e.properties={content_metadata:""}),e.properties.content_metadata={title:r.mediainfo.name,duration:r.mediainfo.duration},E=r.mediainfo.duration)}catch(t){}return e},setProperties:function(e){e.accountCode&&o.setAccountCode(e.accountCode),e.username&&o.setUsername(e.username),"undefined"!=typeof e.isLive&&(v=!0,o.setLive(e.isLive)),e.debug&&(o.debug=e.debug,n=e.debug),e.properties&&o.setProperties(e.properties),e.contentId&&o.setContentId(e.contentId),e.transaction&&o.setTransaction(e.transaction),e.httpSecure&&o.setHttpSecure(e.httpSecure),e.isp&&o.setISP(e.isp),e.cdn&&o.setCDN(e.cdn),e.ip&&o.setIP(e.ip),e.CDNNodeData&&o.setCDNNodeData(e.CDNNodeData),e.parseHLS&&o.setParseHLS(e.parseHLS),e.extraparam1&&o.setExtraParam(1,e.extraparam1),e.extraparam2&&o.setExtraParam(2,e.extraparam2),e.extraparam3&&o.setExtraParam(3,e.extraparam3),e.extraparam4&&o.setExtraParam(4,e.extraparam4),e.extraparam5&&o.setExtraParam(5,e.extraparam5),e.extraparam6&&o.setExtraParam(6,e.extraparam6),e.extraparam7&&o.setExtraParam(7,e.extraparam7),e.extraparam8&&o.setExtraParam(8,e.extraparam8),e.extraparam9&&o.setExtraParam(9,e.extraparam9),e.extraparam10&&o.setExtraParam(10,e.extraparam10),e.balanceProperties&&(e.balanceProperties.enabled=!1,o.setBalanceProperties(e.balanceProperties)),e.concurrencyProperties&&o.setConcurrencyProperties(e.concurrencyProperties),e.resumeProperties&&o.setResumeProperties(e.resumeProperties),e.username&&(i.username=e.username)},startPlugin:function(){try{try{if(p=r,E=r.duration(),(isNaN(E)||"NaN"==E||0/0==E||1/0==E)&&(E=0),n&&console.log("SmartPlugin :: "+l+" :: startPlugin :: HTML5 <video> found!"),J=p.currentSrc(),""!=J&&o.setMediaResource(J),h=new YouboraCommunication(o.getAccountCode(),o.getService(),i,u,s,t),r.youbora.bindEvents(),T&&(h.sendResume(),T=!1),o.getBalanceEnabled()&&h.enableBalancer&&(o.setBalancedResource(!0),""===g)){var e=h.getResourcePath(J);h.getBalancedResource(e,function(e){setBalancedResource(e)})}}catch(a){n&&(console.log(a),console.log("SmartPlugin :: "+l+" :: startPlugin :: No <video> found!"))}}catch(a){n&&console.log("SmartPlugin :: "+l+" :: startPlugin :: Error: "+a)}},bindEvents:function(){try{for(var e=["canplay","playing","waiting","timeupdate","ended","play","pause","error","abort","seeking","seeked","stalled","suspend","progress","dispose","loadeddata","loadstart","adstart","adend","select","videoChange"],t=0;t<e.length;t++)p.on(e[t],function(e){r.youbora.checkPlayState(e)});r.playlist.on("select",function(e){r.youbora.checkPlayState(e)}),r.playlist.on("videoChange",function(e){r.youbora.checkPlayState(e)}),window.on("videoChange",function(e){r.youbora.checkPlayState(e)}),n&&console.log("SmartPlugin :: "+l+" :: bindEvents :: Events atached correctly!")}catch(a){n&&console.log("SmartPlugin :: "+l+" :: bindEvents :: Error: "+a)}},unbindEvents:function(){try{var e=["canplay","playing","waiting","timeupdate","ended","play","pause","error","abort","seeking","seeked","stalled","suspend","progress","dispose","loadeddata","loadstart","adstart","adend","select","videoChange"];for(elem in e)p.off(e[elem],function(){})}catch(r){n&&console.log("SmartPlugin :: "+l+" :: bindEvents :: Error: "+r)}},isAd:function(e){n&&console.log("SmartPlugin :: "+l+" :: isAd :: "+e),D=e},checkPlayState:function(e){switch(n&&console.log("DEBUG: SmartPlugin :: "+l+" :: checkPlayState :: "+e.type),e.type){case"timeupdate":try{C&&0===S&&(F||N)?S=Math.abs((new Date).getTime()-M):C&&-1!=S&&(new Date).getTime()-M>1e4&&(F||N)&&(isAdsFired||w||(h.sendJoin(P,S),w=!0),S=-1),D||(C&&!w&&L&&!G&&r.youbora.setBufferEvent(f.BUFFER_END),b=p.currentSrc(),P=p.currentTime(),P>0&&O+Y<p.currentTime()&&r.youbora.checkBuffering())}catch(t){n&&console.log("SmartPlugin :: "+l+" :: timeupdate :: Error: "+t)}break;case"play":try{if(!D&&!G){if(b=p.currentSrc(),E=p.duration(),!C&&null==p.error()){do o.setMediaResource(p.currentSrc());while(B==p.currentSrc());B=p.currentSrc(),E=p.duration(),(1/0===E||0>E)&&o.setLive(!0),(isNaN(E)||"NaN"==E||0/0==E||1/0==E)&&(E=0),a=null,h.sendStart(0,window.location.href,"",o.getLive(),o.getMediaResource(),E,o.getTransaction()),r.youbora.setPing(),r.youbora.setBufferChecker(),C=!0}T&&(h.sendResume(),T=!1)}}catch(t){n&&console.log("SmartPlugin :: "+l+" :: play :: Error: "+t)}break;case"playing":try{C&&!D&&(r.youbora.checkBuffering(),isAdsFired=!1,T&&(h.sendResume(),T=!1)),x=!0}catch(t){n&&console.log("SmartPlugin :: "+l+" :: playing :: Error: "+t)}break;case"canplay":try{C&&!D&&(F=!0)}catch(t){n&&console.log("SmartPlugin :: "+l+" :: canplay :: Error: "+t)}break;case"adstart":try{isAdsFired=!0,r.youbora.isAd(!0)}catch(t){n&&console.log("SmartPlugin :: "+l+" :: adstart :: Error: "+t)}break;case"adend":try{L=!0,r.youbora.isAd(!1),w||D||G||this.setBufferEvent(f.BUFFER_BEGIN)}catch(t){n&&console.log("SmartPlugin :: "+l+" :: adend :: Error: "+t)}break;case"pause":try{D||G||(C&&h.sendPause(),T=!0)}catch(t){n&&console.log("SmartPlugin :: "+l+" :: pause :: Error: "+t)}break;case"ended":try{C&&!D&&r.youbora.reset()}catch(t){n&&console.log("SmartPlugin :: "+l+" :: ended :: Error: "+t)}break;case"abort":try{C&&!D&&r.youbora.reset()}catch(t){n&&console.log("SmartPlugin :: "+l+" :: abort :: Error: "+t)}break;case"error":try{if(a=r.youbora.setBcoveProperties(a),!_){if(o.getBalanceEnabled()&&h.enableBalancer)n&&console.log("SmartPlugin :: "+l+" :: playerError :: Balancing..."),k=!0,h.sendErrorWithParameters("131"+getBalancerErrorCount(),"CDN_PLAY_FAILURE",0,window.location.href,a,o.getLive(),g[m].URL,p.duration()),m++,r.youbora.refreshBalancedResource();else{var t="3001",c="";try{t=p.error().code,(null!==t||void 0!==t)&&(t=K[t]),void 0==t&&(t="3001"),c=p.error().message,(""===c||null===c)&&(c=p.error().type)}catch(e){console.log(e)}k=!0,r.youbora.checkBuffering(),clearInterval(y),(""===o.getMediaResource()||null===o.getMediaResource())&&o.setMediaResource(p.currentSrc()),h.sendErrorWithParameters(t,c,0,window.location.href,a,o.getLive(),youboraData.getMediaResource(),p.duration()),r.youbora.reset()}_=!0}}catch(t){n&&console.log("SmartPlugin :: "+l+" :: error :: Error: "+t)}break;case"progress":try{C&&(N=!0)}catch(t){n&&console.log("SmartPlugin :: "+l+" :: progress :: Error: "+t)}break;case"waiting":try{D||G||R===!1&&(r.youbora.setBufferEvent(f.BUFFER_BEGIN),R=!0)}catch(t){n&&console.log("SmartPlugin :: "+l+" :: waiting :: Error: "+t)}break;case"seeking":!D&&C&&(G=!0,R=!1,H=!0,V=(new Date).getTime());break;case"seeked":D||(G=!1,R=!1);break;case"stalled":try{U=!0}catch(t){n&&console.log("SmartPlugin :: "+l+" :: isStalledFired :: Error: "+t)}break;case"dispose":r.youbora.unLoad();break;case"loadstart":try{w||D||this.setBufferEvent(f.BUFFER_BEGIN)}catch(t){n&&console.log("SmartPlugin :: "+l+" :: playing :: Error: "+t)}break;case"loadeddata":try{}catch(t){n&&console.log("SmartPlugin :: "+l+" :: loadeddata :: Error: "+t)}break;case"select":case"videoChange":try{}catch(t){n&&console.log("SmartPlugin :: "+l+" :: loadeddata :: Error: "+t)}break;case"buffered":break;case"bufferedEnd":}},setBufferChecker:function(){q=setTimeout(function(){r.youbora.bufferChecker()},300)},bufferChecker:function(){try{if(p.currentTime()>0&&!R&&!T&&!G){{(new Date).getTime()}O>=p.currentTime()&&p.currentTime()<p.duration()&&(z++,z>=2&&(r.youbora.setBufferEvent(f.BUFFER_BEGIN),R=!0,z=0))}}catch(e){console.log(e)}clearTimeout(q),O=p.currentTime(),r.youbora.setBufferChecker()},getBalancerErrorCount:function(){return 10>m?"0"+m:m>10?m:"00"},refreshBalancedResource:function(){try{"undefined"!=typeof g[m]?(p.src(g[m].URL),setTimeout(function(){p.load()},50),p.load()):(o.setBalanceEnabled(!1),p.src(J),setTimeout(function(){p.load()},50),n&&console.log("SmartPlugin :: "+l+" :: Balancer :: End of mirrors"))}catch(e){n&&console.log("SmartPlugin :: "+l+" :: Balancer :: Error :: End of mirrors error:"+e)}},setBalancedResource:function(e){try{if(e!==!1){var r=0;for(index in e)r++;if(g=e,g[""+(r+1)]=new Object,g[""+(r+1)].URL=o.getMediaResource(),"undefined"!=typeof e[1].URL)if(n&&(console.log("SmartPlugin :: "+l+" :: Balance Current Resource  :: "+b),console.log("SmartPlugin :: "+l+" :: Balance Priority Resource :: "+e[1].URL)),e[1].URL!=J){n&&console.log("SmartPlugin :: "+l+" :: Balancing :: "+e[1].URL);try{p.src(e[1].URL),o.setCDN(e[1].CDN_CODE),p.pause(),p.load()}catch(t){n&&console.log("SmartPlugin :: "+l+" :: Balancing :: Error While Changing Media: "+t),p.src(e[1].URL),p.load()}}else n&&console.log("SmartPlugin :: "+l+" :: Balancer :: Same Resource"),o.setBalanceEnabled(!1),p.src(J),p.load();else n&&console.log("SmartPlugin :: "+l+" :: Invalid balance object"),p.load()}else n&&console.log("SmartPlugin :: "+l+" :: Balance unavailable with current parameters"),g="false",p.load()}catch(t){n&&console.log("SmartPlugin :: "+l+" :: setBalancedResource :: Error: "+t)}},checkBuffering:function(){try{R&&C&&w&&!D&&(isAdsFired||r.youbora.setBufferEvent(f.BUFFER_END),z=0,R=!1)}catch(e){n&&console.log("SmartPlugin :: "+l+" :: checkBuffering :: Error: "+e)}},setBufferEvent:function(e){try{var r=new Date,t=0,a=0;switch(e){case f.BUFFER_BEGIN:A=r.getTime(),0===M&&(M=r.getTime());break;case f.BUFFER_END:if(t=r.getTime(),a=t-A,0==w)C&&(h.sendJoin(P,a),w=!0),n&&console.log("SmartPlugin :: "+l+" :: setBufferEvent :: sendJoin");else{var o=(new Date).getTime();(!H||H&&o-V>1e4)&&(0===P&&c&&(P=10),G?n&&console.log("SmartPlugin :: "+l+" :: setBufferEvent :: sendSeek"):(C&&a>=100&&h.sendBuffer(P,a),n&&console.log("SmartPlugin :: "+l+" :: setBufferEvent :: sendBuffer"))),H=!1,V=0,o=0}R=!1}}catch(i){n&&console.log("SmartPlugin :: "+l+" :: setBufferEvent :: Error: "+i)}},setPing:function(){try{y=setTimeout(function(){r.youbora.ping()},h.getPingTime())}catch(e){n&&console.log("SmartPlugin :: "+SmartPlugin.pluginName+" :: setPing :: Error: "+e)}},ping:function(){try{clearTimeout(y);{var e=this.getCurrentBitrate();this.getCurrentBandwidth()}y=null,r.youbora.setPing(),C&&h.sendPingTotalBitrate(e,P)}catch(t){n&&console.log("SmartPlugin :: "+l+" :: Ping :: Error: "+t)}},getCurrentBitrate:function(){try{return r.hls?r.hls.playlists.media().attributes.BANDWIDTH:-1}catch(e){n&&console.log("SmartPlugin :: "+l+" :: getCurrentBitrate :: Error: "+e)}},getCurrentBandwidth:function(){try{return r.hls?r.hls.bandwidth:-1}catch(e){n&&console.log("SmartPlugin :: "+l+" :: getCurrentBandwidth :: Error: "+e)}},defineWatch:function(){try{Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(e,r){var t=this[e],a=t,o=function(){return a},n=function(o){return t=a,a=r.call(this,e,t,o)};delete this[e]&&Object.defineProperty(this,e,{get:o,set:n,enumerable:!0,configurable:!0})}}),Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(e){var r=this[e];delete this[e],this[e]=r}}),setWatch()}catch(e){n&&console.log("SmartPlugin :: "+l+" :: defineWatch :: Error: "+e)}},setWatch:function(){try{var e=["balanceObject","balanceIndex","videoPlayer","urlResource","currentTime","isStreamError","isBuffering","isStartSent","isJoinSent","isPaused","bufferTimeBegin","joinTimeBegin","joinTimeEnd"];for(elem in e)"function"!=typeof e[elem]&&watch(e[elem],function(e,r,t){return console.log("SmartPlugin :: "+l+" :: Watcher :: ["+e+"] From: ["+r+"] To: ["+t+"]"),t})}catch(r){n&&console.log("SmartPlugin :: "+l+" :: setWatch :: Error: "+r)}},reset:function(){try{I=!1,F=!1,N=!1,L=!1,clearTimeout(y),clearTimeout(q),C?h.sendStop():h.reset(),P=0,b="",c=o.getLive(),E=0,O=0,T=!1,C=!1,G=!1,A=0,w=!1,W=0,y="",m=1,g="",x=!1,U=!1,_=!1,isAdsFired=!1,j?S=0:j=!0}catch(e){n&&console.log("SmartPlugin :: "+l+" :: reset :: Error: "+e)}},unLoad:function(){try{clearTimeout(y),clearTimeout(q),h.sendStop(),P=0,b="",c=o.getLive(),E=0,O=0,T=!1,C=!1,L=!1,A=0,w=!1,M=0,W=0,y="",m=1,g="",unbindEvents(),G="",B="",_=!1,delete h}catch(e){n&&console.log("SmartPlugin :: "+l+" :: reset :: Error: "+e)}}},r.youbora.setProperties(a),r.youbora.Init()});