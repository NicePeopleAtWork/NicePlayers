(function(jwplayer){var template=function(player,config,div){var pluginEnabled=false;var pluginVersion="3.2.1-jwplayer7";var pamXML=null;var pamUrl="";var pamSystem="";var pamService="http://nqs.nice264.com";var pamUser="";var transaction="";var bandwidth={};var mediaResource="";var mediaAttributes=null;var mediaBitrate=0;var windowLocation="";var isStartEventSent=false;var isJoinEventSent=false;var continuityTimer=null;var joinTime=0;var bufferTime=0;var seekTime=0;var duration=0;var position=0;var isGlobalLive=null;var pamCode="";var pamCodeOriginal="";var pamCodeCounter=0;var pamPingTime="";var pamBufferUnderRunUrl="";var pamJoinTimeUrl="";var pamStartUrl="";var pamStopUrl="";var pamPauseUrl="";var pamResumeUrl="";var pamContinuityUrl="";var pamErrorUrl="";var pamMediaProperties={};var repeatTime=0;var repeatEvent=null;var iterator=0;var images=[];var total_latency=9e3;var total_band=0;var testCounter=0;var ip="";var country="";var city="";var isp="";var ping="";var band="";var imagesCounter=0;var latencies=[];var bandwidths=[];var genericIndex=0;var totalBandwidhtFiles=0;var username="";var system="";var minutes=0;var isPaused=false;var startDateTime=(new Date).getTime()/1e3;var resume=false;var contentId;var streamModeStartDateTime=(new Date).getTime();var overlayText="";var overlayEnabled=false;var overlayTime=6e4;var overlayDuration=6e3;var isOverlayVisible=false;var overlayTimer=null;var overlayTextColor="black";var overlayBackgroundColor="#415825";var communications={};var resource;var resourceToPass;var resourcePath="";var playlistIndexRequested=NaN;var nextUrlIndexFromBalancer=1;var balancerJson={};var originalResource="";var playlistHasBeenUpdated=false;var seekTime=0;var isOriginalVideoLoaded=false;var originalCdnCode="";var isPlayPressed=false;var cdnCode="";var isSeeking=false;var lastBitrate=-1;var isBuffering=false;var SmartPluginError={"Could not connect to server":"7000","Unsupported Media Format":"7001","Unsupported Media Format":"7002","Cannot load M3U8: 404 not found":"7003","Cannot load M3U8: crossdomain access denied":"7004","Cannot load M3U8: No levels to play":"7005","Error loading player: Flash version must be 10.0 or greater":"7006","Error loading player: No media sources found":"7007","Error loading player: Offline playback not supported":"7008","Error loading skin: File not found":"7009","Error loading skin: Crossdomain loading denied":"7010","Error loading skin: Error loading file":"7011","Error loading skin: Invalid file type":"7012","Error loading skin: Skin formatting error":"7013","Error loading playlist: File not found":"7014","Error loading playlist: Crossdomain loading denied":"7015","Error loading playlist: Error loading file":"7016","Error loading playlist: Not a valid RSS feed":"7017","Error loading playlist: No playable sources found":"7018","Error drawing fallback: No downloadable media found":"7019","Error loading media: File not found":"7020","Error loading media: File could not be played":"7021","Error loading YouTube: Video ID is invalid":"7022","Error loading YouTube: Video removed or private":"7023","Error loading YouTube: Embedding not allowed":"7024","Error loading YouTube: API connection error":"7025","Error loading stream: Could not connect to server":"7026","Error loading stream: ID not found on server":"7027","Error loading stream: Manifest not found or invalid":"7028","Video stutters frequently":"7029","Video is stretched or has black bars":"7030","MP3 playback is too fast or too slow":"7031","FLV video seeking is not working":"7032","MP4 video seeking is not working":"7033","Network Error: http status 404":"7034"};player.on("ready",readyHandler);function readyHandler(event){try{pamUser=getYouboraData().username;pamSystem=getYouboraData().accountCode;bandwidth.username=getYouboraData().username;minutes=getYouboraData().bandwidth;transaction=getYouboraData().transaction;mediaResource=getYouboraData().mediaResource;resume=getYouboraData().resume;contentId=getYouboraData().contentId;isGlobalLive=getYouboraData().live;if(getYouboraData().service!==""&&typeof getYouboraData().service!="undefined"){pamService=getYouboraData().service}var jsonObj=JSON.stringify(getYouboraData().properties);pamMediaProperties=encodeURIComponent(jsonObj);try{communications=new YouboraCommunication(pamSystem,pamService,bandwidth,pluginVersion,"jwplayer",player.id);pamPingTime=communications.getPingTime();player.on("buffer",bufferHandler);player.on("beforePlay",beforePlayHandler);player.on("play",playHandler);player.on("pause",pauseHandler);player.on("time",timeHandler);player.on("meta",metaHandler);player.on("playlistItem",playListItemHandler);player.on("error",errorHandler);player.on("setupError",errorHandler);player.on("idle",idleHandler);player.on("seek",seekHandler);player.on("seeked",seekedHandler);player.on("adClick",function(){});player.on("adCompanions",function(){});player.on("adComplete",function(){});player.on("adError",function(){});player.on("adImpression",function(){});player.on("adMeta",function(){});player.on("adPause",function(){});player.on("adPlay",function(){});player.on("adSkipped",function(){});player.on("adTime",function(){})}catch(err){pamPingTime=5e3;getYouboraData().log("JWPlayer Plugin can't create YouboraCommunication.");getYouboraData().log(err)}if(getYouboraData().jwplayerOverlayText!=undefined){setOverlayText(getYouboraData().jwplayerOverlayText)}else{setOverlayText(getYouboraData().username)}overlayEnabled=getYouboraData().jwplayerOverlayEnabled;overlayTime=getYouboraData().jwplayerOverlayTime;if(overlayTime==undefined){overlayTime=9e4}overlayDuration=getYouboraData().jwplayerOverlayDuration;if(overlayDuration==undefined){overlayDuration=5e3}if(overlayEnabled==true){resetOverlayTimer()}resource=player.getPlaylistItem().file;originalResource=player.getPlaylistItem();originalCdnCode=getYouboraData().getCDN();resourceToPass=mediaResource==undefined||mediaResource==""?resource:mediaResource;getYouboraData().mediaResource=resourceToPass;try{resourcePath=communications.getResourcePath(resourceToPass)}catch(err){getYouboraData().log(err)}if(!isBalancerActive()){isOriginalVideoLoaded=true}}catch(err){if(getYouboraData()!=undefined)getYouboraData().log(err);else console.log(err)}}function isBalancerActive(){return getYouboraData().getBalanceEnabled()}function callbackBalancer(jsonObject){try{if(jsonObject!=false){getYouboraData().isBalanced=true;nextUrlIndexFromBalancer=1;balancerJson=jsonObject;updatePlayList(jsonObject)}else{isOriginalVideoLoaded=true;getYouboraData().setEnableBalancer(false)}}catch(err){getYouboraData().log(err)}}function updatePlayList(jsonObject){var newPlayList=new Array;playlistIndexRequested=player.getPlaylistIndex();for(var i=0;i<player.getPlaylist().length;i++){if(i==player.getPlaylistIndex()){var currentPlayingFile=player.getPlaylistItem();if(typeof jsonObject[nextUrlIndexFromBalancer]=="undefined"){currentPlayingFile=originalResource;getYouboraData().setCDN(originalCdnCode);isOriginalVideoLoaded=true}else{var balancerUrl=jsonObject[nextUrlIndexFromBalancer].URL;getYouboraData().setCDN(jsonObject[nextUrlIndexFromBalancer].CDN_CODE);currentPlayingFile.file=balancerUrl;currentPlayingFile.sources[0].file=balancerUrl;nextUrlIndexFromBalancer=nextUrlIndexFromBalancer+1}newPlayList.push(currentPlayingFile)}else{newPlayList.push(player.getPlaylistItem(i))}}playlistHasBeenUpdated=true;player.load(newPlayList)}this.resize=function(width,height){};function playListItemHandler(event){if(getYouboraData().jwplayerStreamMode==false){resetAnalytics()}if(isBalancerActive()){resetAnalytics();seekTime=0;if(!playlistHasBeenUpdated){communications.getBalancedResource(resourcePath,callbackBalancer);playlistIndexRequested=player.getPlaylistIndex()}else{player.playlistItem(playlistIndexRequested);playlistHasBeenUpdated=false}}}function idleHandler(event){if(getYouboraData().jwplayerStreamMode==false){var oldState=event.oldstate;if(oldState=="playing"||oldState=="paused"){sendAnalytics("stop");resetAnalytics()}}}function seekHandler(event){seekTime=(new Date).getTime();isSeeking=true}function seekedHandler(event){}function bufferHandler(event){if(isJoinEventSent){getYouboraData().log("sp :: BufferStart");isPlayPressed=true;if(event.oldstate!="paused"&&event.oldstate!="idle"){var now=new Date;bufferTime=now.getTime();isBuffering=true}}}function beforePlayHandler(event){if(!isStartEventSent&&!isBalancerActive()){startDateTime=(new Date).getTime()/1e3;isStartEventSent=true;sendAnalytics("start");setPing();if(!isJoinEventSent){joinTime=(new Date).getTime()}}}function playHandler(event){if(!isStartEventSent){startDateTime=(new Date).getTime()/1e3;isStartEventSent=true;sendAnalytics("start");setPing()}if(isPaused||event.oldstate=="paused"&&event.newstate=="playing"){sendAnalytics("resume");isPaused=false}isSeeking=false}function pauseHandler(event){isPaused=true;sendAnalytics("pause")}function timeHandler(event){duration=event.duration;if(position&&Math.abs(position*1e3-event.position*1e3<600)){if(isStartEventSent&&!isJoinEventSent){isJoinEventSent=true;sendAnalytics("join",{diff:Math.round((new Date).getTime()-joinTime),duration:Math.round(duration)})}if(isSeeking){isSeeking=false;isBuffering=false;sendAnalytics("seek",Math.round((new Date).getTime()-seekTime))}if(isBuffering){isBuffering=false;var bufferTimeDiff=Math.round((new Date).getTime()-bufferTime);sendAnalytics("buffer",Math.round(bufferTimeDiff))}}position=event.position;if(getYouboraData().jwplayerStreamMode==false){if(event.duration>0){if(event.position-1>=event.duration-1){sendAnalytics("stop");resetAnalytics()}}}}function metaHandler(event){mediaAttributes=event;try{duration=event.metadata.duration}catch(e){}if(duration==0){try{duration=event.duration}catch(e){getYouboraData().log(e)}}}function errorHandler(message){try{player.stop();sendAnalytics("error","",message);sendAnalytics("stop");resetAnalytics()}catch(err){getYouboraData().log(err)}finally{if(isBalancerActive()&&!isOriginalVideoLoaded){seekTime=player.getPosition();updatePlayList(balancerJson)}}}function resumePlay(){seekTime=player.getPosition();player.play()}function updateCode(){if(pamCodeCounter<=0){pamCodeOriginal=pamCode}pamCodeCounter++;pamCode=pamCodeOriginal+"_"+pamCodeCounter}function resetAnalytics(){clearPing();updateCode();isStartEventSent=false;isJoinEventSent=false;continuityTimer=null;joinTime=0;bufferTime=0}function loadAnalytics(response){try{pamCode=response.c;pamXML=response;pluginEnabled=true}catch(err){pluginEnabled=false}}function sendAnalytics(type,videoPlayTime,errorObj){var request_url="";if(getYouboraData().jwplayerStreamMode==true){try{var accTime=((new Date).getTime()-streamModeStartDateTime)/1e3;videoPlayTime=accTime}catch(e){getYouboraData().log(e)}}switch(type){case"buffer":var currentPosition=0;try{currentPosition=player.getPosition()}catch(err){currentPosition=0}if(currentPosition==0){currentPosition=(new Date).getTime()/1e3-startDateTime}communications.sendBuffer(Math.round(currentPosition),videoPlayTime);break;case"join":var eventTime=0;try{eventTime=player.getPosition()/1e3}catch(err){}communications.sendJoinWithMediaDuration(Math.round(eventTime),videoPlayTime.diff,videoPlayTime.duration);break;case"start":try{var pingTimeInSeconds=pamPingTime/1e3;var isLive=true;var duration=0;if(mediaAttributes!=null&&mediaAttributes){if(typeof mediaAttributes.duration!=="undefined"){duration=mediaAttributes.duration}else{if(typeof mediaAttributes.metadata!=="undefined"){duration=mediaAttributes.metadata.duration}}}if(typeof duration==="undefined"){duration=player.getDuration()}var resource=player.getPlaylistItem().file;resourceToPass=typeof mediaResource==="undefined"||mediaResource==""?resource:mediaResource;getYouboraData().mediaResource=resourceToPass;duration=typeof duration==="undefined"?0:duration;if(duration>0){isLive=false}if(isGlobalLive!=null){isLive=isGlobalLive}if(isLive==true){duration=0}windowLocation=window.location.href.toString();communications.sendStart("0",windowLocation,pamMediaProperties,isLive,resourceToPass,duration,transaction)}catch(err){getYouboraData().log(err)}break;case"stop":communications.sendStop();break;case"pause":communications.sendPause();break;case"resume":communications.sendResume();break;case"continuity":var qtys=null;var bitrate=0;try{qtys=player.getQualityLevels();bitrate=qtys[player.getCurrentQuality()].bitrate;if(typeof bitrate==="undefined"||typeof bitrate===null){bitrate=-1}else{bitrate=bitrate}if(bitrate==0||bitrate==-1){if(mediaAttributes!=null&&(mediaAttributes.metadata!=null&&typeof mediaAttributes.metadata!=="undefined")){if(mediaAttributes.metadata.currentLevel!=null&&mediaAttributes.metadata.currentLevel!=="undefined"){var currentLevel=mediaAttributes.metadata.currentLevel;var regex=/(([0-9]+)kbps)/i;bitrate=currentLevel.match(regex)[2];bitrate=bitrate*1024}}}if(bitrate==0){bitrate=-1}}catch(err){bitrate=-1;getYouboraData().log(err)}if(bitrate==-1){bitrate=lastBitrate}else{lastBitrate=bitrate}var currentPosition=0;try{currentPosition=player.getPosition()}catch(err){currentPosition=0}var pingTimeInSeconds=pamPingTime/1e3;communications.sendPingTotalBitrate(bitrate?bitrate:-1,videoPlayTime);setPing();break;case"error":var pingTimeInSeconds=pamPingTime/1e3;if(mediaAttributes!=null){if(mediaAttributes.duration>0){isLive=false}}var resource=player.getPlaylistItem().file;var resourceToPass=mediaResource==""?resource:mediaResource;if(isGlobalLive!=null||isGlobalLive!=undefined){isLive=isGlobalLive}windowLocation=window.location.href.toString();if(isStartEventSent){try{errorCode=SmartPluginError[errorObj.message];errorMsg=parseError(errorObj);errorTotalBytes="0";errorReferer=windowLocation;errorProperties=pamMediaProperties;errorIsLive=isLive;errorResource=resourceToPass;errorDuration=duration;errorTransaction=transaction;communications.sendAdvancedError(errorCode,"jwplayer7",errorMsg,errorTotalBytes,errorReferer,errorProperties,errorIsLive,errorResource,errorDuration,errorTransaction)}catch(e){getYouboraData().log(e)}}else if(isBalancerActive()){var errorCode="";if(!isOriginalVideoLoaded){errorCode=13e3+nextUrlIndexFromBalancer-1}else{errorCode=13100+nextUrlIndexFromBalancer-1}errorMsg=parseError(errorObj);errorTotalBytes="0";errorReferer=windowLocation;errorProperties=pamMediaProperties;errorIsLive=isLive;errorResource=resourceToPass;errorDuration=mediaAttributes.duration;errorTransaction=transaction;communications.sendAdvancedError(errorCode.toString(),"jwplayer7",errorMsg,errorTotalBytes,errorReferer,errorProperties,errorIsLive,errorResource,errorDuration,errorTransaction)}break;case"seek":var currentPosition=0;try{currentPosition=player.getPosition()}catch(err){currentPosition=0}if(currentPosition==0){currentPosition=(new Date).getTime()/1e3-startDateTime}communications.sendSeek(currentPosition,videoPlayTime);break}}this.setProperties=function(props_obj){var jsonObj=JSON.stringify(props_obj);pamMediaProperties=encodeURIComponent(jsonObj)};this.setTransaction=function(trans){transaction=trans};this.setLive=function(isLive){isGlobalLive=isLive};this.setMediaResource=function(resource_url){mediaResource=encodeURIComponent(resource_url)};function setPing(){try{continuityTimer=setTimeout(function(){sendAnalytics("continuity",player.getPosition())},pamPingTime)}catch(err){getYouboraData().log(err)}}function clearPing(){clearInterval(continuityTimer)}function parseError(error_obj){var jsonObj=JSON.stringify(error_obj);return encodeURIComponent(jsonObj)}function setOverlayText(text){div.innerHTML=text;overlayText=text;hideOverlay()}this.setOverlayText=function(text){setOverlayText(text)};this.setOverlayEnabled=function(enabled){overlayEnabled=enabled};this.setOverlayTime=function(time){overlayTime=time};this.setOverlayDuration=function(time){overlayDuration=time};this.stop=function(){sendAnalytics("stop");resetAnalytics()};this.onPlayEvent=function(event){playHandler(event)};function setStyleOverlay(object){for(var style in object){div.style[style]=object[style]}}function showOverlay(){isOverlayVisible=true;if(overlayEnabled)createStyleOverlay();if(overlayEnabled==true){setStyleOverlay({opacity:1})}else{hideOverlay()}}function hideOverlay(){isOverlayVisible=false;setStyleOverlay({opacity:0})}function resetOverlayTimer(){try{if(!isOverlayVisible){setTimeout(function(){showOverlay();resetOverlayTimer()},overlayTime)}else{setTimeout(function(){hideOverlay();resetOverlayTimer()},overlayDuration)}}catch(err){getYouboraData().log(err)}}function createStyleOverlay(){var yPosition=player.getHeight()-.25*player.getHeight();var textSize=7;var xPosition=Math.floor(Math.random()*(player.getWidth()-overlayText.length*textSize));if(getYouboraData().jwplayerOverlayTextColor!=undefined){overlayTextColor=getYouboraData().jwplayerOverlayTextColor}if(getYouboraData().jwplayerOverlayBackgroundColor!=undefined){overlayBackgroundColor=getYouboraData().jwplayerOverlayBackgroundColor}setStyleOverlay({position:"absolute",left:xPosition+"px",top:yPosition+"px",margin:"0",padding:"5px 10px 5px",background:overlayBackgroundColor,"font-weight":"bold",color:overlayTextColor,fontSize:"13px"})}this.resize=function(width,height){if(overlayEnabled)createStyleOverlay()};function getYouboraData(){try{if(typeof youboraDataMap!=="undefined"){return youboraDataMap.get(player.id)}else{return youboraData}}catch(err){if(debug)console.log(err.stack.replace(" at ","\r\n	at "))}}};jwplayer().registerPlugin("sp.min","6.0",template)})(jwplayer);